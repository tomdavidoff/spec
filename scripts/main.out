
R version 4.4.1 (2024-06-14) -- "Race for Your Life"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # main.R
> # R to analyze spec/custom choice
> # Tom Davidoff
> 
> library(data.table)
> library(readstata13)
> library(fixest)
> library(ggplot2)
> 
> do16 <- 0
> if (do16==1)  {
+     (source("scripts/get16.R"))
+ }
> d16 <- fread("data/derived/baseline16.csv")
> print(summary(d16))
   folioID           roll_number             MB_year_built  MB_effective_year
 Length:25640       Min.   : 1023636540000   Min.   :1900   Min.   :1909     
 Class :character   1st Qu.: 5731056220000   1st Qu.:1942   1st Qu.:1970     
 Mode  :character   Median :16741216240000   Median :1978   Median :1986     
                    Mean   :14145787111320   Mean   :1971   Mean   :1985     
                    3rd Qu.:20586300230000   3rd Qu.:1997   3rd Qu.:2000     
                    Max.   :25830270550000   Max.   :2020   Max.   :2020     
                                             NA's   :24     NA's   :24       
   landValue       improvementValue   streetNumber  streetDirectionPrefix
 Min.   : 199000   Min.   :      0   Min.   :   3   Mode:logical         
 1st Qu.:1020000   1st Qu.:  53500   1st Qu.:1742   NA's:25640           
 Median :1213000   Median : 155000   Median :2879                        
 Mean   :1470442   Mean   : 238800   Mean   :3046                        
 3rd Qu.:1870000   3rd Qu.: 293000   3rd Qu.:4032                        
 Max.   :8880000   Max.   :3801000   Max.   :8571                        
                                     NA's   :2                           
  streetName         streetType        streetDirectionSuffix  postalCode       
 Length:25640       Length:25640       Length:25640          Length:25640      
 Class :character   Class :character   Class :character      Class :character  
 Mode  :character   Mode  :character   Mode  :character      Mode  :character  
                                                                               
                                                                               
                                                                               
                                                                               
     city             thirty          fifty           laneok       
 Length:25640       Mode :logical   Mode :logical   Mode :logical  
 Class :character   FALSE:4991      FALSE:20649     FALSE:503      
 Mode  :character   TRUE :20649     TRUE :4991      TRUE :23474    
                                                    NA's :1663     
                                                                   
                                                                   
                                                                   
> 
> do24 <- 0
> if (do24==1)  {
+     (source("scripts/get24.R"))
+ }
> d24 <- fread("data/derived/use24.csv")
> print(summary(d24))
   FOLIO_ID         ACTUAL_USE_DESCRIPTION JURISDICTION_CODE NEIGHBOURHOOD     
 Length:77530       Length:77530           Min.   :200       Length:77530      
 Class :character   Class :character       1st Qu.:200       Class :character  
 Mode  :character   Mode  :character       Median :200       Mode  :character  
                                           Mean   :200                         
                                           3rd Qu.:200                         
                                           Max.   :200                         
                                                                               
     nchar      splitspot    rollStart            rollEnd24       
 Min.   :15   Min.   :11   Min.   : 101963206   Min.   :   0.000  
 1st Qu.:15   1st Qu.:11   1st Qu.: 813073905   1st Qu.:   0.000  
 Median :15   Median :11   Median :1721681936   Median :   0.000  
 Mean   :15   Mean   :11   Mean   :1507320016   Mean   :   0.694  
 3rd Qu.:15   3rd Qu.:11   3rd Qu.:2163827160   3rd Qu.:   0.000  
 Max.   :15   Max.   :11   Max.   :2583027085   Max.   :4001.000  
                                                                  
  Jurisdiction MB_Year_Built     Zoning          ROLL_NUMBER24           
 Min.   :200   Min.   :1900   Length:77530       Min.   : 1019632060000  
 1st Qu.:200   1st Qu.:1950   Class :character   1st Qu.: 8130739050000  
 Median :200   Median :1986   Mode  :character   Median :17216819360000  
 Mean   :200   Mean   :1977                      Mean   :15073200163654  
 3rd Qu.:200   3rd Qu.:2008                      3rd Qu.:21638271600000  
 Max.   :200   Max.   :2023                      Max.   :25830270850000  
               NA's   :523                                               
 UNIT_NUMBER        STREET_NUMBER   STREET_DIRECTION_PREFIX STREET_NAME       
 Length:77530       Min.   :    1   Length:77530            Length:77530      
 Class :character   1st Qu.: 1753   Class :character        Class :character  
 Mode  :character   Median : 3074   Mode  :character        Mode  :character  
                    Mean   : 3229                                             
                    3rd Qu.: 4465                                             
                    Max.   :74088                                             
                    NA's   :21                                                
 STREET_TYPE        STREET_DIRECTION_SUFFIX POSTAL_CODE       
 Length:77530       Length:77530            Length:77530      
 Class :character   Class :character        Class :character  
 Mode  :character   Mode  :character        Mode  :character  
                                                              
                                                              
                                                              
                                                              
 fullStreet24       streetNoNumber24   streetNumber24 
 Length:77530       Length:77530       Min.   :    1  
 Class :character   Class :character   1st Qu.: 1753  
 Mode  :character   Mode  :character   Median : 3074  
                                       Mean   : 3229  
                                       3rd Qu.: 4465  
                                       Max.   :74088  
                                       NA's   :21     
> 
> 
> # merge on roll number fragment
> 
> d24[,rollStart:=as.numeric(rollStart)]
> d24[,rollEnd24:=as.numeric(rollEnd24)]
> 
> d16[,rollStart:=floor(roll_number/10000)]
> d16[,rollEnd16:=roll_number %% 10000]
> 
> d24 <- merge(d24,d16,by.x=c("rollStart"),by.y=c("rollStart")) 
> print(summary(d24))
   rollStart           FOLIO_ID         ACTUAL_USE_DESCRIPTION
 Min.   :1.024e+08   Length:31936       Length:31936          
 1st Qu.:5.737e+08   Class :character   Class :character      
 Median :1.676e+09   Mode  :character   Mode  :character      
 Mean   :1.436e+09                                            
 3rd Qu.:2.059e+09                                            
 Max.   :2.583e+09                                            
                                                              
 JURISDICTION_CODE NEIGHBOURHOOD          nchar      splitspot 
 Min.   :200       Length:31936       Min.   :15   Min.   :11  
 1st Qu.:200       Class :character   1st Qu.:15   1st Qu.:11  
 Median :200       Mode  :character   Median :15   Median :11  
 Mean   :200                          Mean   :15   Mean   :11  
 3rd Qu.:200                          3rd Qu.:15   3rd Qu.:11  
 Max.   :200                          Max.   :15   Max.   :11  
                                                               
   rollEnd24        Jurisdiction MB_Year_Built     Zoning         
 Min.   :0.00000   Min.   :200   Min.   :1900   Length:31936      
 1st Qu.:0.00000   1st Qu.:200   1st Qu.:1949   Class :character  
 Median :0.00000   Median :200   Median :1989   Mode  :character  
 Mean   :0.01976   Mean   :200   Mean   :1979                     
 3rd Qu.:0.00000   3rd Qu.:200   3rd Qu.:2011                     
 Max.   :3.00000   Max.   :200   Max.   :2023                     
                                 NA's   :137                      
 ROLL_NUMBER24            UNIT_NUMBER        STREET_NUMBER  
 Min.   : 1023636540000   Length:31936       Min.   :    2  
 1st Qu.: 5737097260000   Class :character   1st Qu.: 1551  
 Median :16758201410000   Mode  :character   Median : 2887  
 Mean   :14362021408364                      Mean   : 3041  
 3rd Qu.:20587300480001                      3rd Qu.: 4048  
 Max.   :25830270550000                      Max.   :74088  
                                             NA's   :4      
 STREET_DIRECTION_PREFIX STREET_NAME        STREET_TYPE       
 Length:31936            Length:31936       Length:31936      
 Class :character        Class :character   Class :character  
 Mode  :character        Mode  :character   Mode  :character  
                                                              
                                                              
                                                              
                                                              
 STREET_DIRECTION_SUFFIX POSTAL_CODE        fullStreet24      
 Length:31936            Length:31936       Length:31936      
 Class :character        Class :character   Class :character  
 Mode  :character        Mode  :character   Mode  :character  
                                                              
                                                              
                                                              
                                                              
 streetNoNumber24   streetNumber24    folioID           roll_number            
 Length:31936       Min.   :    2   Length:31936       Min.   : 1023636540000  
 Class :character   1st Qu.: 1551   Class :character   1st Qu.: 5737097260000  
 Mode  :character   Median : 2887   Mode  :character   Median :16758201410000  
                    Mean   : 3041                      Mean   :14362021408364  
                    3rd Qu.: 4048                      3rd Qu.:20587300480000  
                    Max.   :74088                      Max.   :25830270550000  
                    NA's   :4                                                  
 MB_year_built  MB_effective_year   landValue       improvementValue 
 Min.   :1900   Min.   :1909      Min.   : 199000   Min.   :      0  
 1st Qu.:1946   1st Qu.:1970      1st Qu.:1020000   1st Qu.:  52900  
 Median :1984   Median :1990      Median :1219000   Median : 169000  
 Mean   :1975   Mean   :1988      Mean   :1458804   Mean   : 265909  
 3rd Qu.:2009   3rd Qu.:2010      3rd Qu.:1840000   3rd Qu.: 348000  
 Max.   :2020   Max.   :2020      Max.   :8880000   Max.   :3801000  
 NA's   :50     NA's   :50                                           
  streetNumber  streetDirectionPrefix  streetName         streetType       
 Min.   :   3   Mode:logical          Length:31936       Length:31936      
 1st Qu.:1542   NA's:31936            Class :character   Class :character  
 Median :2886                         Mode  :character   Mode  :character  
 Mean   :3035                                                              
 3rd Qu.:4043                                                              
 Max.   :8571                                                              
 NA's   :4                                                                 
 streetDirectionSuffix  postalCode            city             thirty       
 Length:31936          Length:31936       Length:31936       Mode :logical  
 Class :character      Class :character   Class :character   FALSE:6223     
 Mode  :character      Mode  :character   Mode  :character   TRUE :25713    
                                                                            
                                                                            
                                                                            
                                                                            
   fifty           laneok          rollEnd16
 Mode :logical   Mode :logical   Min.   :0  
 FALSE:25713     FALSE:567       1st Qu.:0  
 TRUE :6223      TRUE :27733     Median :0  
                 NA's :3636      Mean   :0  
                                 3rd Qu.:0  
                                 Max.   :0  
                                            
> 
> dLaneway <- openxlsx::read.xlsx("data/raw/20250401_UBC_CustomLanewayReport.xlsx")
> #dLaneway <- read.dta13("data/raw/Laneway list 2015-23.dta")
> print(names(dLaneway))
[1] "Area"      "Jur"       "Roll"      "PID"       "PrimAUC"   "MCC"      
[7] "YearBuilt"
> dLaneway <- data.table(dLaneway)[,.(Roll,Jur,YearBuilt)]
> print(table(dLaneway[,Jur]))

 200 
5918 
> dLaneway[,Jur==NULL]
logical(0)
> dLaneway[,Roll:=as.character(as.numeric(Roll))]
> dLaneway[,hasLaneway:=1]
> d24[,Roll:=as.character(roll_number)]
> 
> d24 <- merge(d24,dLaneway,by="Roll",all.x=TRUE,all.y=TRUE)
> print(table(d24[,.(is.na(hasLaneway),is.na(rollEnd24))])) # about 50% of laneways -- not bad as all 30 50
       V2
V1      FALSE  TRUE
  FALSE  7441  3957
  TRUE  24495     0
> print(summary(d24[hasLaneway==1]))
     Roll             rollStart           FOLIO_ID        
 Length:11398       Min.   :1.634e+08   Length:11398      
 Class :character   1st Qu.:9.714e+08   Class :character  
 Mode  :character   Median :1.780e+09   Mode  :character  
                    Mean   :1.561e+09                     
                    3rd Qu.:2.161e+09                     
                    Max.   :2.583e+09                     
                    NA's   :3957                          
 ACTUAL_USE_DESCRIPTION JURISDICTION_CODE NEIGHBOURHOOD          nchar     
 Length:11398           Min.   :200       Length:11398       Min.   :15    
 Class :character       1st Qu.:200       Class :character   1st Qu.:15    
 Mode  :character       Median :200       Mode  :character   Median :15    
                        Mean   :200                          Mean   :15    
                        3rd Qu.:200                          3rd Qu.:15    
                        Max.   :200                          Max.   :15    
                        NA's   :3957                         NA's   :3957  
   splitspot      rollEnd24     Jurisdiction  MB_Year_Built     Zoning         
 Min.   :11     Min.   :0      Min.   :200    Min.   :1905   Length:11398      
 1st Qu.:11     1st Qu.:0      1st Qu.:200    1st Qu.:2007   Class :character  
 Median :11     Median :0      Median :200    Median :2013   Mode  :character  
 Mean   :11     Mean   :0      Mean   :200    Mean   :2002                     
 3rd Qu.:11     3rd Qu.:0      3rd Qu.:200    3rd Qu.:2017                     
 Max.   :11     Max.   :0      Max.   :200    Max.   :2023                     
 NA's   :3957   NA's   :3957   NA's   :3957   NA's   :3997                     
 ROLL_NUMBER24            UNIT_NUMBER        STREET_NUMBER  
 Min.   : 1634037190000   Length:11398       Min.   :    2  
 1st Qu.: 9714153140000   Class :character   1st Qu.: 1079  
 Median :17803197640000   Mode  :character   Median : 2807  
 Mean   :15611953793535                      Mean   : 2979  
 3rd Qu.:21607280300000                      3rd Qu.: 4043  
 Max.   :25828251390000                      Max.   :74088  
 NA's   :          3957                      NA's   :3957   
 STREET_DIRECTION_PREFIX STREET_NAME        STREET_TYPE       
 Length:11398            Length:11398       Length:11398      
 Class :character        Class :character   Class :character  
 Mode  :character        Mode  :character   Mode  :character  
                                                              
                                                              
                                                              
                                                              
 STREET_DIRECTION_SUFFIX POSTAL_CODE        fullStreet24      
 Length:11398            Length:11398       Length:11398      
 Class :character        Class :character   Class :character  
 Mode  :character        Mode  :character   Mode  :character  
                                                              
                                                              
                                                              
                                                              
 streetNoNumber24   streetNumber24    folioID           roll_number            
 Length:11398       Min.   :    2   Length:11398       Min.   : 1634037190000  
 Class :character   1st Qu.: 1079   Class :character   1st Qu.: 9714153140000  
 Mode  :character   Median : 2807   Mode  :character   Median :17803197640000  
                    Mean   : 2979                      Mean   :15611953793535  
                    3rd Qu.: 4043                      3rd Qu.:21607280300000  
                    Max.   :74088                      Max.   :25828251390000  
                    NA's   :3957                       NA's   :          3957  
 MB_year_built  MB_effective_year   landValue       improvementValue 
 Min.   :1905   Min.   :1928      Min.   : 684000   Min.   :      0  
 1st Qu.:1989   1st Qu.:1996      1st Qu.:1020000   1st Qu.:  48500  
 Median :2012   Median :2012      Median :1125000   Median : 286000  
 Mean   :1995   Mean   :2003      Mean   :1367980   Mean   : 379251  
 3rd Qu.:2015   3rd Qu.:2015      3rd Qu.:1650000   3rd Qu.: 581000  
 Max.   :2020   Max.   :2020      Max.   :3574000   Max.   :1836000  
 NA's   :3986   NA's   :3986      NA's   :3957      NA's   :3957     
  streetNumber  streetDirectionPrefix  streetName         streetType       
 Min.   :   8   Mode:logical          Length:11398       Length:11398      
 1st Qu.:1060   NA's:11398            Class :character   Class :character  
 Median :2805                         Mode  :character   Mode  :character  
 Mean   :2956                                                              
 3rd Qu.:4039                                                              
 Max.   :8273                                                              
 NA's   :3957                                                              
 streetDirectionSuffix  postalCode            city             thirty       
 Length:11398          Length:11398       Length:11398       Mode :logical  
 Class :character      Class :character   Class :character   FALSE:1471     
 Mode  :character      Mode  :character   Mode  :character   TRUE :5970     
                                                             NA's :3957     
                                                                            
                                                                            
                                                                            
   fifty           laneok          rollEnd16        Jur           
 Mode :logical   Mode :logical   Min.   :   0   Length:11398      
 FALSE:5970      FALSE:32        1st Qu.:   0   Class :character  
 TRUE :1471      TRUE :5110      Median :   0   Mode  :character  
 NA's :3957      NA's :6256      Mean   :   0                     
                                 3rd Qu.:   0                     
                                 Max.   :   0                     
                                 NA's   :3957                     
  YearBuilt           hasLaneway
 Length:11398       Min.   :1   
 Class :character   1st Qu.:1   
 Mode  :character   Median :1   
                    Mean   :1   
                    3rd Qu.:1   
                    Max.   :1   
                                
> print(summary(d24[,YearBuilt==MB_Year_Built]))
   Mode   FALSE    TRUE    NA's 
logical    3058    4343   28492 
> print(d24[hasLaneway==1 & YearBuilt!=MB_Year_Built])
Key: <Roll>
                Roll  rollStart   FOLIO_ID          ACTUAL_USE_DESCRIPTION
              <char>      <num>     <char>                          <char>
   1: 10813124770000 1081312477 A000001CV1 Residential Dwelling with Suite
   2: 10813124770000 1081312477 A000001CV1 Residential Dwelling with Suite
   3: 10813124770000 1081312477 A000001CV1 Residential Dwelling with Suite
   4: 10813124770000 1081312477 A000001CV1 Residential Dwelling with Suite
   5: 10813124770000 1081312477 A000001CV1 Residential Dwelling with Suite
  ---                                                                     
3054:  9747179640000  974717964 A000001ALB Residential Dwelling with Suite
3055:  9747179640000  974717964 A000001ALB Residential Dwelling with Suite
3056:  9747179640000  974717964 A000001ALB Residential Dwelling with Suite
3057:  9747179640000  974717964 A000001ALB Residential Dwelling with Suite
3058:  9747179640000  974717964 A000001ALB Residential Dwelling with Suite
      JURISDICTION_CODE   NEIGHBOURHOOD nchar splitspot rollEnd24 Jurisdiction
                  <int>          <char> <int>     <int>     <num>        <int>
   1:               200 South Granville    15        11         0          200
   2:               200 South Granville    15        11         0          200
   3:               200 South Granville    15        11         0          200
   4:               200 South Granville    15        11         0          200
   5:               200 South Granville    15        11         0          200
  ---                                                                         
3054:               200          Cambie    15        11         0          200
3055:               200          Cambie    15        11         0          200
3056:               200          Cambie    15        11         0          200
3057:               200          Cambie    15        11         0          200
3058:               200          Cambie    15        11         0          200
      MB_Year_Built Zoning  ROLL_NUMBER24 UNIT_NUMBER STREET_NUMBER
              <int> <char>          <i64>      <char>         <int>
   1:          1988    RS1 10813124770000                      1523
   2:          1988    RS1 10813124770000                      1523
   3:          1988    RS1 10813124770000                      1523
   4:          1988    RS1 10813124770000                      1525
   5:          1988    RS1 10813124770000                      1525
  ---                                                              
3054:          1940    RS1  9747179640000                       136
3055:          1940    RS1  9747179640000                       136
3056:          1940    RS1  9747179640000                       138
3057:          1940    RS1  9747179640000                       138
3058:          1940    RS1  9747179640000                       138
      STREET_DIRECTION_PREFIX STREET_NAME STREET_TYPE STREET_DIRECTION_SUFFIX
                       <char>      <char>      <char>                  <char>
   1:                                59TH         AVE                       W
   2:                                59TH         AVE                       W
   3:                                59TH         AVE                       W
   4:                                59TH         AVE                       W
   5:                                59TH         AVE                       W
  ---                                                                        
3054:                                40TH         AVE                       W
3055:                                40TH         AVE                       W
3056:                                40TH         AVE                       W
3057:                                40TH         AVE                       W
3058:                                40TH         AVE                       W
      POSTAL_CODE     fullStreet24 streetNoNumber24 streetNumber24    folioID
           <char>           <char>           <char>          <int>     <char>
   1:     V6P 1Z1 1523  59TH AVE W       59TH AVE W           1523 A000001CV1
   2:     V6P 1Z1 1523  59TH AVE W       59TH AVE W           1523 A000001CV1
   3:     V6P 1Z1 1523  59TH AVE W       59TH AVE W           1523 A000001CV1
   4:     V6P 1Z1 1525  59TH AVE W       59TH AVE W           1525 A000001CV1
   5:     V6P 1Z1 1525  59TH AVE W       59TH AVE W           1525 A000001CV1
  ---                                                                        
3054:     V5Y 2R2  136  40TH AVE W       40TH AVE W            136 A000001ALB
3055:     V5Y 2R2  136  40TH AVE W       40TH AVE W            136 A000001ALB
3056:     V5Y 2R2  138  40TH AVE W       40TH AVE W            138 A000001ALB
3057:     V5Y 2R2  138  40TH AVE W       40TH AVE W            138 A000001ALB
3058:     V5Y 2R2  138  40TH AVE W       40TH AVE W            138 A000001ALB
         roll_number MB_year_built MB_effective_year landValue improvementValue
               <i64>         <int>             <int>     <int>            <int>
   1: 10813124770000          1988              1991   2143000           380000
   2: 10813124770000          1988              1991   2143000           380000
   3: 10813124770000          1988              1991   2143000           380000
   4: 10813124770000          1988              1991   2143000           380000
   5: 10813124770000          1988              1991   2143000           380000
  ---                                                                          
3054:  9747179640000          1940              1995   2082000           753000
3055:  9747179640000          1940              1995   2082000           753000
3056:  9747179640000          1940              1995   2082000           753000
3057:  9747179640000          1940              1995   2082000           753000
3058:  9747179640000          1940              1995   2082000           753000
      streetNumber streetDirectionPrefix streetName streetType
             <int>                <lgcl>     <char>     <char>
   1:         1523                    NA       59TH        AVE
   2:         1525                    NA       59TH        AVE
   3:         1527                    NA       59TH        AVE
   4:         1523                    NA       59TH        AVE
   5:         1525                    NA       59TH        AVE
  ---                                                         
3054:          138                    NA       40TH        AVE
3055:          140                    NA       40TH        AVE
3056:          136                    NA       40TH        AVE
3057:          138                    NA       40TH        AVE
3058:          140                    NA       40TH        AVE
      streetDirectionSuffix postalCode      city thirty  fifty laneok rollEnd16
                     <char>     <char>    <char> <lgcl> <lgcl> <lgcl>     <i64>
   1:                     W    V6P 1Z1 VANCOUVER  FALSE   TRUE   TRUE         0
   2:                     W    V6P 1Z1 VANCOUVER  FALSE   TRUE   TRUE         0
   3:                     W    V6P 1Z1 VANCOUVER  FALSE   TRUE   TRUE         0
   4:                     W    V6P 1Z1 VANCOUVER  FALSE   TRUE   TRUE         0
   5:                     W    V6P 1Z1 VANCOUVER  FALSE   TRUE   TRUE         0
  ---                                                                          
3054:                     W            VANCOUVER  FALSE   TRUE     NA         0
3055:                     W    V5Y 2R2 VANCOUVER  FALSE   TRUE   TRUE         0
3056:                     W    V5Y 2R2 VANCOUVER  FALSE   TRUE     NA         0
3057:                     W            VANCOUVER  FALSE   TRUE     NA         0
3058:                     W    V5Y 2R2 VANCOUVER  FALSE   TRUE   TRUE         0
         Jur YearBuilt hasLaneway
      <char>    <char>      <num>
   1:    200      2016          1
   2:    200      2016          1
   3:    200      2016          1
   4:    200      2016          1
   5:    200      2016          1
  ---                            
3054:    200      2011          1
3055:    200      2011          1
3056:    200      2011          1
3057:    200      2011          1
3058:    200      2011          1
> d24[,hasLaneway:=ifelse(is.na(hasLaneway),0,hasLaneway)]
> 
> # get max transaction date by roll rumber
> dMaxSale <- fread("data/derived/maxSale.csv")
> d24 <- merge(d24,dMaxSale,by.x="ROLL_NUMBER24",by.y="ROLL_NUMBER",all.x=TRUE)
> d24[,duplex:=grepl("Duplex,",ACTUAL_USE_DESCRIPTION)]
> d24[,basement:=grepl("Residential Dwelling with Suite",ACTUAL_USE_DESCRIPTION)]
> d24[,single:=grepl("Single Family Dwelling",ACTUAL_USE_DESCRIPTION)]
> d24[,type:=ifelse(duplex==1,"duplex",ifelse(hasLaneway==1,"laneway",ifelse(basement==1,"basement",ifelse(single==1,"single","other"))))]
> print(table(d24[,type]))

basement   duplex  laneway    other   single 
   12763      740    11386      143    10861 
> print(summary(d24[,MB_Year_Built]))
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   1900    1949    1989    1979    2011    2023    4094 
> d24[,spec:=0]
> d24[,sale2024:=0]
> FIRST_BUILT <- 2010 # Note can do early for the non-duplex stuff, and no duplex really pre-18
> LAST_BUILT <- 2023 # pre-duplex era?
> for (y in seq(FIRST_BUILT,LAST_BUILT)) {
+     #d24[MB_Year_Built==y & (get(paste0("sale",y))==1 | get(paste0("sale",y+1))==1 | get(paste0("sale",y+2))==1  ),spec:=1]
+     d24[MB_Year_Built==y & (get(paste0("sale",y))==1 | get(paste0("sale",y+1))==1  ),spec:=1]
+     #d24[MB_Year_Built==y & ( get(paste0("sale",y+1))==1  ),spec:=1]
+ }
> for (y in seq(FIRST_BUILT,LAST_BUILT)) {
+     print(y)
+     print(table(d24[MB_Year_Built==y,.(type,spec)]))
+ }
[1] 2010
          spec
type         0   1
  basement 158 124
  laneway  150  54
  other      4   0
  single    25  24
[1] 2011
          spec
type         0   1
  basement 230 198
  laneway  306 206
  other      4   0
  single    48  42
[1] 2012
          spec
type         0   1
  basement 216 207
  laneway  320 213
  other      0   1
  single    49  50
[1] 2013
          spec
type         0   1
  basement 158 150
  laneway  350 188
  single    44  30
[1] 2014
          spec
type         0   1
  basement 124 126
  laneway  396 202
  single    35  30
[1] 2015
          spec
type         0   1
  basement 140  62
  duplex     9   0
  laneway  539 267
  single    48  17
[1] 2016
          spec
type         0   1
  basement  58  20
  laneway  302 100
  single    24  10
[1] 2017
          spec
type         0   1
  basement  51  12
  duplex     1   0
  laneway  295  52
  single    45   6
[1] 2018
          spec
type         0   1
  basement  88   8
  laneway  339  78
  single    49   3
[1] 2019
          spec
type         0   1
  basement  47   8
  duplex    19   1
  laneway  265  54
  single    32   1
[1] 2020
          spec
type         0   1
  basement  39   8
  duplex    38  79
  laneway  189  25
  single    14   1
[1] 2021
          spec
type         0   1
  basement  30  10
  duplex    79 101
  laneway  123  40
  single    18   5
[1] 2022
          spec
type         0   1
  basement  34  10
  duplex   138 107
  laneway  242  29
  single    31   7
[1] 2023
          spec
type         0   1
  basement  31   0
  duplex    87  11
  laneway  119   4
  other      4   0
  single    26   0
> 
> print(table(d24[MB_Year_Built>2016 & MB_Year_Built<2023,.(type,spec,STREET_DIRECTION_SUFFIX)]))
, , STREET_DIRECTION_SUFFIX = 

          spec
type         0   1
  basement  67   9
  duplex   139 131
  laneway  505 119
  single    35   2

, , STREET_DIRECTION_SUFFIX = E

          spec
type         0   1
  basement  70  14
  duplex    85 133
  laneway  544 120
  single    23   3

, , STREET_DIRECTION_SUFFIX = N

          spec
type         0   1
  basement   0   0
  duplex     0   1
  laneway    4   2
  single     0   0

, , STREET_DIRECTION_SUFFIX = SE

          spec
type         0   1
  basement   0   0
  duplex     0   0
  laneway    3   0
  single     0   0

, , STREET_DIRECTION_SUFFIX = W

          spec
type         0   1
  basement 152  33
  duplex    51  23
  laneway  397  37
  single   131  18

> print(table(d24[thirty==1 & MB_Year_Built>2016 & MB_Year_Built<2022,.(type,spec,STREET_DIRECTION_SUFFIX)]))
, , STREET_DIRECTION_SUFFIX = 

          spec
type         0   1
  basement  49   9
  duplex    45  57
  laneway  350 101
  single    22   1

, , STREET_DIRECTION_SUFFIX = E

          spec
type         0   1
  basement  63   9
  duplex    33  76
  laneway  400  93
  single    12   0

, , STREET_DIRECTION_SUFFIX = N

          spec
type         0   1
  basement   0   0
  duplex     0   0
  laneway    4   2
  single     0   0

, , STREET_DIRECTION_SUFFIX = W

          spec
type         0   1
  basement  91  25
  duplex    15   8
  laneway  197  28
  single    67  11

> print(table(d24[thirty==0 & MB_Year_Built>2016 & MB_Year_Built<2022,.(type,spec,STREET_DIRECTION_SUFFIX)]))
, , STREET_DIRECTION_SUFFIX = 

          spec
type         0   1
  basement   5   0
  duplex    22  16
  laneway   76   7
  single     9   1

, , STREET_DIRECTION_SUFFIX = E

          spec
type         0   1
  basement   2   2
  duplex    15  20
  laneway   55  16
  single     1   0

, , STREET_DIRECTION_SUFFIX = SE

          spec
type         0   1
  basement   0   0
  duplex     0   0
  laneway    3   0
  single     0   0

, , STREET_DIRECTION_SUFFIX = W

          spec
type         0   1
  basement  45   1
  duplex     7   4
  laneway  126   2
  single    47   3

> print(table(d24[thirty==1 & MB_Year_Built>2016 & MB_Year_Built<2022,.(type,spec,NEIGHBOURHOOD)]))
, , NEIGHBOURHOOD = Arbutus Ridge - Mackenzie Heights

          spec
type         0   1
  basement   2   3
  duplex     0   0
  laneway   22   0
  single     4   0

, , NEIGHBOURHOOD = Cambie

          spec
type         0   1
  basement  20   5
  duplex     5   0
  laneway   42   4
  single     6   1

, , NEIGHBOURHOOD = Cedar Cottage

          spec
type         0   1
  basement   6   7
  duplex     0   4
  laneway   15   6
  single     4   0

, , NEIGHBOURHOOD = Collingwood

          spec
type         0   1
  basement   4   0
  duplex     4  12
  laneway   26   3
  single     0   0

, , NEIGHBOURHOOD = Dunbar

          spec
type         0   1
  basement  22   5
  duplex     0   0
  laneway   31   3
  single    24   5

, , NEIGHBOURHOOD = Fraserview

          spec
type         0   1
  basement   1   0
  duplex     0   0
  laneway    3   0
  single     0   0

, , NEIGHBOURHOOD = Grandview

          spec
type         0   1
  basement   0   0
  duplex     2  10
  laneway    5   0
  single     0   0

, , NEIGHBOURHOOD = Hastings East

          spec
type         0   1
  basement  16   0
  duplex    17  12
  laneway   87  30
  single     8   1

, , NEIGHBOURHOOD = Kerrisdale

          spec
type         0   1
  basement   2   3
  duplex     0   2
  laneway   18   0
  single     7   0

, , NEIGHBOURHOOD = Killarney

          spec
type         0   1
  basement   6   2
  duplex     7  17
  laneway   49   9
  single     1   0

, , NEIGHBOURHOOD = Kitsilano

          spec
type         0   1
  basement  16   6
  duplex     4   2
  laneway   29  11
  single     9   2

, , NEIGHBOURHOOD = Knight

          spec
type         0   1
  basement  10   0
  duplex     3   7
  laneway   82  15
  single     1   0

, , NEIGHBOURHOOD = Main & Fraser

          spec
type         0   1
  basement  18   7
  duplex    11  16
  laneway   96  40
  single     5   0

, , NEIGHBOURHOOD = Marpole

          spec
type         0   1
  basement  12   0
  duplex     2   6
  laneway   44   8
  single     3   0

, , NEIGHBOURHOOD = Oakridge

          spec
type         0   1
  basement   2   0
  duplex     0   0
  laneway    3   3
  single     1   0

, , NEIGHBOURHOOD = Point Grey

          spec
type         0   1
  basement  27   3
  duplex     7   1
  laneway   58   6
  single    23   3

, , NEIGHBOURHOOD = Renfrew

          spec
type         0   1
  basement  19   2
  duplex    13  18
  laneway  147  51
  single     4   0

, , NEIGHBOURHOOD = Renfrew Heights

          spec
type         0   1
  basement   6   0
  duplex     4  13
  laneway   45  15
  single     0   0

, , NEIGHBOURHOOD = South Granville

          spec
type         0   1
  basement   0   0
  duplex     0   0
  laneway    0   0
  single     1   0

, , NEIGHBOURHOOD = South Vancouver

          spec
type         0   1
  basement  13   0
  duplex    14  21
  laneway  149  20
  single     0   0

, , NEIGHBOURHOOD = Southlands

          spec
type         0   1
  basement   1   0
  duplex     0   0
  laneway    0   0
  single     0   0

> print(table(d24[thirty==0 & MB_Year_Built>2016 & MB_Year_Built<2022,.(type,spec,NEIGHBOURHOOD)]))
, , NEIGHBOURHOOD = Arbutus Ridge - Mackenzie Heights

          spec
type        0  1
  basement 10  0
  duplex    4  2
  laneway  31  0
  single   15  3

, , NEIGHBOURHOOD = Cambie

          spec
type        0  1
  basement  0  0
  duplex    7  0
  laneway   6  0
  single    1  0

, , NEIGHBOURHOOD = Cedar Cottage

          spec
type        0  1
  basement  0  2
  duplex   12  1
  laneway  13  0
  single    1  0

, , NEIGHBOURHOOD = Collingwood

          spec
type        0  1
  basement  0  0
  duplex    0  0
  laneway  12  3
  single    0  0

, , NEIGHBOURHOOD = Dunbar

          spec
type        0  1
  basement  8  1
  duplex    0  0
  laneway  45  0
  single   11  1

, , NEIGHBOURHOOD = Fraserview

          spec
type        0  1
  basement  2  0
  duplex    2  2
  laneway  16  0
  single    0  0

, , NEIGHBOURHOOD = Grandview

          spec
type        0  1
  basement  0  0
  duplex    0  8
  laneway   0  0
  single    0  0

, , NEIGHBOURHOOD = Hastings East

          spec
type        0  1
  basement  0  0
  duplex   10  4
  laneway   7  2
  single    0  0

, , NEIGHBOURHOOD = Kerrisdale

          spec
type        0  1
  basement  7  0
  duplex    4  0
  laneway  13  4
  single   14  0

, , NEIGHBOURHOOD = Killarney

          spec
type        0  1
  basement  0  0
  duplex    0  4
  laneway   6 13
  single    0  0

, , NEIGHBOURHOOD = Kitsilano

          spec
type        0  1
  basement 11  0
  duplex    0  0
  laneway  22  0
  single    3  0

, , NEIGHBOURHOOD = Main & Fraser

          spec
type        0  1
  basement  0  0
  duplex    0  0
  laneway  13  0
  single    0  0

, , NEIGHBOURHOOD = Marpole

          spec
type        0  1
  basement  0  0
  duplex    0  8
  laneway   0  0
  single    1  0

, , NEIGHBOURHOOD = Oakridge

          spec
type        0  1
  basement  0  0
  duplex    0  0
  laneway   3  0
  single    0  0

, , NEIGHBOURHOOD = Point Grey

          spec
type        0  1
  basement  7  0
  duplex    0  0
  laneway  22  0
  single    8  0

, , NEIGHBOURHOOD = Renfrew

          spec
type        0  1
  basement  0  0
  duplex    1 11
  laneway   9  0
  single    0  0

, , NEIGHBOURHOOD = Renfrew Heights

          spec
type        0  1
  basement  0  0
  duplex    0  0
  laneway   3  0
  single    0  0

, , NEIGHBOURHOOD = Shaughnessy

          spec
type        0  1
  basement  2  0
  duplex    0  0
  laneway   2  0
  single    0  0

, , NEIGHBOURHOOD = South Granville

          spec
type        0  1
  basement  5  0
  duplex    0  0
  laneway   9  0
  single    2  0

, , NEIGHBOURHOOD = South Vancouver

          spec
type        0  1
  basement  0  0
  duplex    4  0
  laneway  23  3
  single    0  0

, , NEIGHBOURHOOD = Southlands

          spec
type        0  1
  basement  0  0
  duplex    0  0
  laneway   5  0
  single    1  0

> 
> # Main regression
> # Dummy for spec vs custom on property type dummies and share 
> shares <- data.table(nbhd=character(),year=numeric(),thirty=integer(),type=character(),shareType=numeric(),typeSpec=numeric(),specShare=numeric(),priceLag=numeric())
> dsales <- fread("data/derived/sales.csv")
> dsales <- merge(dsales,d24[,.(ROLL_NUMBER24,MB_Year_Built,type,NEIGHBOURHOOD,thirty,spec)],by.x="ROLL_NUMBER",by.y="ROLL_NUMBER24")
> sales <- dsales[CONVEYANCE_DATE==MB_Year_Built | (CONVEYANCE_DATE==MB_Year_Built+1) ]
> for  (n in unique(dsales[,NEIGHBOURHOOD])) {
+ 	print(n)
+ 	print(dsales[NEIGHBOURHOOD==n & type=="duplex" & CONVEYANCE_DATE>2019 & thirty==1,CONVEYANCE_PRICE])
+ 	print(quantile(dsales[NEIGHBOURHOOD==n & type=="duplex" & CONVEYANCE_DATE>2019 & thirty==1,CONVEYANCE_PRICE],na.rm=TRUE))
+ }
[1] "Point Grey"
[1] 2184000   20710 2300000 2639375 1300000 1200000
     0%     25%     50%     75%    100% 
  20710 1225000 1742000 2271000 2639375 
[1] "Kitsilano"
 [1] 3188000 3188000 3188000 3188000 3188000 3188000 2250000 2360000 2540952
[10] 2585000 2476480      NA 2615000      NA 2050000 2050000 2030000 2080000
[19] 2498000
     0%     25%     50%     75%    100% 
2030000 2250000 2540952 3188000 3188000 
[1] "Dunbar"
[1] 2558000 2380000 2418000
     0%     25%     50%     75%    100% 
2380000 2399000 2418000 2488000 2558000 
[1] "Arbutus Ridge - Mackenzie Heights"
integer(0)
  0%  25%  50%  75% 100% 
  NA   NA   NA   NA   NA 
[1] "Kerrisdale"
[1] 2188000 2138000
     0%     25%     50%     75%    100% 
2138000 2150500 2163000 2175500 2188000 
[1] "Southlands"
integer(0)
  0%  25%  50%  75% 100% 
  NA   NA   NA   NA   NA 
[1] "Shaughnessy"
integer(0)
  0%  25%  50%  75% 100% 
  NA   NA   NA   NA   NA 
[1] "Cambie"
 [1] 2200000 2200000 2200000 1563500 1563500 1563500 1563500 1020550 1020550
[10] 2188000 2188000 2188000 2188000 2024200 2024200 2024200 2024200
     0%     25%     50%     75%    100% 
1020550 1563500 2024200 2188000 2200000 
[1] "South Granville"
integer(0)
  0%  25%  50%  75% 100% 
  NA   NA   NA   NA   NA 
[1] "Oakridge"
integer(0)
  0%  25%  50%  75% 100% 
  NA   NA   NA   NA   NA 
[1] "Marpole"
 [1] 1971000 1971000 1971000 1715700 1715700 1715700 1971000 1971000 1971000
[10] 1724900 1724900 1724900 1860000 1860000 1860000 2000000 2000000 2000000
[19] 2280000 2280000 2068000 2068000 2068000 2000000 2000000 2000000   40000
[28]   40000  980000  980000
     0%     25%     50%     75%    100% 
  40000 1724900 1971000 2000000 2280000 
[1] "Grandview"
 [1] 1700000 1700000 1268300 1580000 1580000 1325000 1591750 1490000 1490476
[10] 1525000 1750000 1865000 1839800 1849000
     0%     25%     50%     75%    100% 
1268300 1499107 1585875 1737500 1865000 
[1] "Cedar Cottage"
[1] 1588000 1688000 2145000 2215000 1988000 1998000 1800000 1925000 1700000
     0%     25%     50%     75%    100% 
1588000 1700000 1925000 1998000 2215000 
[1] "Main & Fraser"
 [1] 1702000 1865000 1800000 1800000 1800000 1684600 1684600 1684600 1570000
[10] 1570000 1570000 1570000 1570000 1670000 1638000  821000  821000 1540000
[19] 1385000 1565000 1900000 1700000 1610000   33100   33100   33100 1655000
[28] 1655000 1655000 1348100 1348100 1348100 1642857 1875000 1830000 1850000
[37] 1680000 1680000 1680000  909200  909200  909200 1818400 1818400 1818400
[46] 2125000 2125000 1750000 1750000 1935000 1458000 1508000 1508000 1517000
[55] 1598000 1600000 1600000 1514000 1480000 1575000 1575000 1885000 1897000
[64] 1750000 1750000 1810000 1810000 1700000 1700000 1460000 1325000
     0%     25%     50%     75%    100% 
  33100 1511000 1655000 1775000 2125000 
[1] "South Vancouver"
 [1] 1125714 1125714 1125714 1440000 1440000 1440000 1231500 1231500 1550000
[10] 1550000 1360000 1523000 1550476 1569523 1350000 1350000 1388000 1388000
[19] 1494285 1590000 1500000 1450000 1412000 1900000 1650000 1700000 1700000
[28] 1680000 1680000 1148571 1148571 1281000 1281000 1609523 1609523 1720000
[37] 1800000 1713333 1276190 1300000 1070000 1070000 1070000 1388000 1388000
[46] 1400000 1400000 1450000
     0%     25%     50%     75%    100% 
1070000 1281000 1426000 1574642 1900000 
[1] "Knight"
 [1] 1550000 1555000 1420000 1420000 1050000 1050000 1224000 1309523 1331428
[10] 1525000 1525000 1245000 1245000 1219400 1219400    1976    1976    1976
[19]    1976 1615000 1615000 1615000 1505000 1650000 1680000 1630000 1630000
[28] 1630000  775000 1286000 1428571 1704001 1704001 1704001 1265000 1269000
[37] 1888000 1888000 1888000 1590000 1500000
     0%     25%     50%     75%    100% 
   1976 1245000 1500000 1630000 1888000 
[1] "Hastings East"
 [1] 1951000 1951000 1488000 1488000 1498000 1501900 1465000 1139500 1585000
[10] 1500000 1500000 1549900 1480000 1480000 1480000 1571428 1670000 1300000
[19] 1300000 1300000 1300000 1300000 1260000 1260000 1260000 1260000 1260000
[28] 1510000 1365000 1339000 1339000 1113900 1113900 1357142 1699000 1749000
[37] 2035000 2035000 1555000 1555000 1510000 1620000 1760000 1830000 1630000
[46] 1630000      NA      NA 1410000 1650000 1475000 1475000 1475000 1475000
[55] 1550000 1550000 1495238 1525000 1630000 1630000 1505000 1505000 1505000
[64] 1291500 1291500 1291500 1825000 1725000 1700000 1700000 1700000 1300400
[73] 1300400 1300400 1571428 1571428 1571428 1310000 1639000 1639000 1538095
[82] 1679000 1699000 1450000 1435000 1450000 1375000 1350000 1280000 1280000
[91] 1280000 1280000 1280000 1800000 1800000 1800000 1720000 1720000 1720000
     0%     25%     50%     75%    100% 
1113900 1310000 1500000 1639000 2035000 
[1] "Renfrew"
 [1] 1400000 1400000 1400000 1400000 1400000 1370000 1640000 1640000 1388000
[10] 1298000 2165000 2165000 1679000 1699900 1701888 1701888 1610000 1610000
[19] 1599000 1599000 1460000 1610000 1620000 1474000 1461000 1620000 1620000
[28] 1599000 1649000 1630000 1899000 1630000 1595000 1220000 1885000 1885000
[37] 1885000 1328200 1328200 1328200 1435000 1499000 1385000 1385000 1385000
[46] 1200000 1635000 1635000 1685000 1685000 1250000 1250000 1198000 1240000
[55] 1660000 1675000 1450000 1450000 1450000 1706000 1799000 1768000 1768000
[64] 1768000 1545000 1545000 1545000 1650000 1650000 1350000 1350000 1725000
[73] 1725000 1725000 1305800 1305800 1305800 1380000 1430000 1413000 1408000
[82] 1295500 1295500 1430000 1550000 1487500 1487500 1252380 1580000 1265000
[91] 1250000
     0%     25%     50%     75%    100% 
1198000 1385000 1545000 1650000 2165000 
[1] "Renfrew Heights"
 [1] 1620000 1665000 1439000 1439000 1439000 1434000 1434000 1434000 1982000
[10] 1982000 1982000 1265000 1265000 1265000 1301000 1301000 1301000 1301000
[19] 1301000 1100000 1100000 1100000 1100000 1100000 1548000 1548000 1300000
[28] 1300000 1535000 1529000 1400000 1400000 1400000 1050000 1137700
     0%     25%     50%     75%    100% 
1050000 1265000 1400000 1484000 1982000 
[1] "Collingwood"
 [1] 1500000 1580000 1352380 1410000 1175700 1595238 1595238 1410000 1410000
[10] 1175700 1175700 1438000 1438000 1208600 1208600 1220000 1220000 1428571
[19] 1428571 1600000 1600000 1790000 1790000 1790000 3300000 3300000 1330000
[28] 1330000 1188000
     0%     25%     50%     75%    100% 
1175700 1220000 1428571 1595238 3300000 
[1] "Killarney"
 [1] 1350000 1350000 1350000 1350000 1350000 1549000 1230500 1500000 1500000
[10] 1333333 1333333 1418000 1418000 1322857 1322857 1495238 1420000 1210000
[19] 1485714 1485714 1460000 1590000 1540000  789000  789000  789000  789000
[28]  789000  789000 1675000 1675000 1675000 1095238 1333333 1333333 1400000
[37] 1657142 1657142 1237142 1237142 1238095 1238095
     0%     25%     50%     75%    100% 
 789000 1237380 1350000 1492857 1675000 
[1] "Fraserview"
integer(0)
  0%  25%  50%  75% 100% 
  NA   NA   NA   NA   NA 
> KEEPLAG <- 1
> for (y in seq(FIRST_BUILT,LAST_BUILT)) {
+ 	for (n in unique(d24$NEIGHBOURHOOD)) {
+ 		for (s in c(0,1)) { #consider 50', too
+ 		#for (s in c(1)) {
+ 			dsub <- d24[NEIGHBOURHOOD==n & MB_Year_Built==y & thirty==s  ]
+ 			for (t in c("single","duplex","laneway","basement")) {
+ 			#for (t in c("single","laneway","basement")) {
+ 				dss <- dsales[CONVEYANCE_TYPE_DESCRIPTION=="Improved Single Property Transaction" & NEIGHBOURHOOD==n & CONVEYANCE_DATE<y & CONVEYANCE_DATE>=(y-KEEPLAG) & thirty==s & type==t]
+ 				shares <- rbind(shares,data.table(nbhd=n,year=y,thirty=s,type=t,shareType=dsub[,mean(type==t)],typeSpec=dsub[type==t,mean(spec==1)],specShare=dsub[spec==1,mean(type==t)],priceLag=dss[,log(median(CONVEYANCE_PRICE,na.rm=TRUE))]))
+ 			}
+ 		    }
+         }
+ }
> print(summary(shares))
     nbhd                year          thirty        type          
 Length:2576        Min.   :2010   Min.   :0.0   Length:2576       
 Class :character   1st Qu.:2013   1st Qu.:0.0   Class :character  
 Mode  :character   Median :2016   Median :0.5   Mode  :character  
                    Mean   :2016   Mean   :0.5                     
                    3rd Qu.:2020   3rd Qu.:1.0                     
                    Max.   :2023   Max.   :1.0                     
                                                                   
   shareType         typeSpec        specShare         priceLag    
 Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :12.97  
 1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:14.04  
 Median :0.0136   Median :0.0000   Median :0.0000   Median :14.37  
 Mean   :0.2494   Mean   :0.2607   Mean   :0.2499   Mean   :14.37  
 3rd Qu.:0.4552   3rd Qu.:0.5000   3rd Qu.:0.4743   3rd Qu.:14.77  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :15.64  
 NA's   :716      NA's   :1643     NA's   :1424     NA's   :1106   
> 
> 
> dnew <- d24[MB_Year_Built>FIRST_BUILT & MB_Year_Built<2023]
> print(dnew[MB_Year_Built>2016,mean(spec),by=type])
       type        V1
     <char>     <num>
1:   single 0.1084906
2:   duplex 0.5115453
3:  laneway 0.1606008
4: basement 0.1623188
> print(dnew[MB_Year_Built>2016,mean(spec),by=MB_Year_Built])
   MB_Year_Built        V1
           <int>     <num>
1:          2019 0.1498829
2:          2020 0.2875318
3:          2018 0.1575221
4:          2021 0.3842365
5:          2022 0.2558528
6:          2017 0.1515152
> print(dnew[MB_Year_Built>2016,quantile(improvementValue,na.rm=TRUE),by=.(spec)])
     spec     V1
    <num>  <num>
 1:     0   6800
 2:     0  24800
 3:     0  34500
 4:     0  68600
 5:     0 591000
 6:     1   9200
 7:     1  22400
 8:     1  29300
 9:     1  46400
10:     1 411000
> print(dnew[MB_Year_Built>2016,mean(improvementValue,na.rm=TRUE),by=.(spec)])
    spec       V1
   <num>    <num>
1:     0 59575.61
2:     1 44648.06
> print(summary(feols(improvementValue~spec | MB_Year_Built ^ NEIGHBOURHOOD ^ thirty,data=dnew[MB_Year_Built>2016])))
OLS estimation, Dep. Var.: improvementValue
Observations: 2,851
Fixed-effects: MB_Year_Built^NEIGHBOURHOOD^thirty: 196
Standard-errors: Clustered (MB_Year_Built^NEIGHBOURHOOD^thirty) 
     Estimate Std. Error  t value  Pr(>|t|)    
spec -9497.31    3591.09 -2.64468 0.0088429 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 49,937.0     Adj. R2: 0.325019
                 Within R2: 0.004768
> print(summary(feols(log(improvementValue)~spec | MB_Year_Built ^ NEIGHBOURHOOD ^ thirty,data=dnew[MB_Year_Built>2016])))
OLS estimation, Dep. Var.: log(improvementValue)
Observations: 2,851
Fixed-effects: MB_Year_Built^NEIGHBOURHOOD^thirty: 196
Standard-errors: Clustered (MB_Year_Built^NEIGHBOURHOOD^thirty) 
      Estimate Std. Error  t value Pr(>|t|)    
spec -0.161608   0.055616 -2.90578 0.004087 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.618011     Adj. R2: 0.290685
                 Within R2: 0.008976
> print(summary(feols(landValue~spec | MB_Year_Built ^ NEIGHBOURHOOD ^ thirty,data=dnew[MB_Year_Built>2016])))
OLS estimation, Dep. Var.: landValue
Observations: 2,851
Fixed-effects: MB_Year_Built^NEIGHBOURHOOD^thirty: 196
Standard-errors: Clustered (MB_Year_Built^NEIGHBOURHOOD^thirty) 
     Estimate Std. Error  t value Pr(>|t|) 
spec   4674.6    7734.85 0.604355  0.54631 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 126,330.7     Adj. R2: 0.942851
                  Within R2: 1.813e-4
> print(summary(feols(log(landValue)~spec | MB_Year_Built ^ NEIGHBOURHOOD ^ thirty,data=dnew[MB_Year_Built>2016])))
OLS estimation, Dep. Var.: log(landValue)
Observations: 2,851
Fixed-effects: MB_Year_Built^NEIGHBOURHOOD^thirty: 196
Standard-errors: Clustered (MB_Year_Built^NEIGHBOURHOOD^thirty) 
     Estimate Std. Error  t value Pr(>|t|) 
spec 0.000486   0.005814 0.083571  0.93348 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.077483     Adj. R2: 0.943955
                 Within R2: 5.209e-6
> 
> # neighbourhood and type variation in spec?
> print(dnew[,mean(spec),by=type])
       type        V1
     <char>     <num>
1:   single 0.3161189
2:   duplex 0.5034965
3: basement 0.4026549
4:  laneway 0.2839844
5:    other 0.2000000
> print(dnew[,.(mean(spec),mean(type=="duplex")),by=.(NEIGHBOURHOOD)])
                        NEIGHBOURHOOD        V1         V2
                               <char>     <num>      <num>
 1:                        Point Grey 0.3214286 0.01428571
 2:                         Kitsilano 0.2761506 0.05648536
 3:                            Dunbar 0.3366337 0.00990099
 4: Arbutus Ridge - Mackenzie Heights 0.3055556 0.02083333
 5:                        Kerrisdale 0.2460317 0.04761905
 6:                        Southlands 0.4634146 0.12195122
 7:                       Shaughnessy 0.2631579 0.00000000
 8:                            Cambie 0.2472648 0.06126915
 9:                   South Granville 0.3508772 0.00000000
10:                          Oakridge 0.2894737 0.00000000
11:                           Marpole 0.3746224 0.09969789
12:                         Grandview 0.3921569 0.43137255
13:                     Cedar Cottage 0.3068783 0.13227513
14:                     Main & Fraser 0.3443073 0.05624143
15:                   South Vancouver 0.2547170 0.05660377
16:                            Knight 0.3241252 0.06077348
17:                     Hastings East 0.4307932 0.14930016
18:                           Renfrew 0.4155556 0.08666667
19:                   Renfrew Heights 0.3344371 0.11589404
20:                       Collingwood 0.3730570 0.10362694
21:                         Killarney 0.3453815 0.07831325
22:                        Fraserview 0.2397260 0.02739726
                        NEIGHBOURHOOD        V1         V2
> print(dnew[MB_Year_Built<2019,.(mean(spec),mean(type=="duplex")),by=.(NEIGHBOURHOOD)])
                        NEIGHBOURHOOD        V1         V2
                               <char>     <num>      <num>
 1:                        Point Grey 0.3636364 0.00000000
 2:                         Kitsilano 0.3052632 0.00000000
 3:                            Dunbar 0.3849287 0.00000000
 4: Arbutus Ridge - Mackenzie Heights 0.3727273 0.00000000
 5:                        Kerrisdale 0.2879581 0.00000000
 6:                        Southlands 0.4666667 0.00000000
 7:                       Shaughnessy 0.2777778 0.00000000
 8:                            Cambie 0.2904110 0.02739726
 9:                   South Granville 0.5263158 0.00000000
10:                          Oakridge 0.3027523 0.00000000
11:                           Marpole 0.4047619 0.00000000
12:                         Grandview 0.0000000 0.00000000
13:                     Cedar Cottage 0.2750000 0.00000000
14:                     Main & Fraser 0.3402778 0.00000000
15:                   South Vancouver 0.2649800 0.00000000
16:                            Knight 0.3497758 0.00000000
17:                     Hastings East 0.4726891 0.00000000
18:                           Renfrew 0.4025605 0.00000000
19:                   Renfrew Heights 0.3433476 0.00000000
20:                       Collingwood 0.4054054 0.00000000
21:                         Killarney 0.3206107 0.00000000
22:                        Fraserview 0.2619048 0.00000000
                        NEIGHBOURHOOD        V1         V2
> 
> # note individual reg actually lower t-stat than group level
> print("fraction spec among new by rounded 2016 improvement value")
[1] "fraction spec among new by rounded 2016 improvement value"
> STEP <- 10000
> ggplot(dnew[,.(n=.N,spec=mean(spec)),by=.(improvement=round(improvementValue/STEP)*STEP)],aes(x=improvement,y=spec,size=n)) + geom_point()
> ggsave("text/specImprovement.png")
Saving 7 x 7 in image
> # do it with year_built
> ggplot(dnew[MB_year_built<2016,.(n=.N,spec=mean(spec)),by=.(yearBuilt=MB_year_built)],aes(x=yearBuilt,y=spec,size=n)) + geom_point()
> ggsave("text/specYearBuilt.png")
Saving 7 x 7 in image
> # now effective year
> ggplot(dnew[MB_effective_year<2016,.(n=.N,spec=mean(spec)),by=.(effectiveYear=MB_effective_year)],aes(x=effectiveYear,y=spec,size=n)) + geom_point()
> ggsave("text/specEffectiveYear.png")
Saving 7 x 7 in image
> print(dnew[order(MB_year_built),.(.N,mean(spec)),by=.(MB_year_built)])
    MB_year_built     N         V2
            <int> <int>      <num>
 1:          1905     3 0.00000000
 2:          1906     4 0.00000000
 3:          1907     2 0.00000000
 4:          1908     7 0.00000000
 5:          1910    25 0.44000000
 6:          1911    10 0.50000000
 7:          1912    34 0.67647059
 8:          1913    17 0.52941176
 9:          1914    20 0.40000000
10:          1915     6 0.33333333
11:          1916     3 0.00000000
12:          1918     2 0.00000000
13:          1919     2 0.00000000
14:          1920     9 0.22222222
15:          1921     8 0.87500000
16:          1922    17 0.29411765
17:          1923    15 0.00000000
18:          1924     5 1.00000000
19:          1925    14 0.00000000
20:          1926    45 0.33333333
21:          1927    46 0.30434783
22:          1928    40 0.30000000
23:          1929    16 0.37500000
24:          1930    40 0.25000000
25:          1931    28 0.35714286
26:          1932    10 0.50000000
27:          1935     1 0.00000000
28:          1936     8 0.50000000
29:          1937     6 0.00000000
30:          1938    12 0.16666667
31:          1939    25 0.28000000
32:          1940    25 0.28000000
33:          1941    24 0.33333333
34:          1942    30 0.56666667
35:          1943     5 0.20000000
36:          1944    37 0.54054054
37:          1945    32 0.34375000
38:          1946    51 0.23529412
39:          1947    30 0.30000000
40:          1948    44 0.15909091
41:          1949    21 0.42857143
42:          1950    20 0.20000000
43:          1951    16 0.31250000
44:          1952    18 0.11111111
45:          1953    36 0.33333333
46:          1954     8 0.00000000
47:          1955    30 0.43333333
48:          1956    18 0.05555556
49:          1957    13 0.15384615
50:          1958    18 0.16666667
51:          1959    10 0.60000000
52:          1960     7 0.14285714
53:          1961    10 0.20000000
54:          1962    11 0.63636364
55:          1963     8 0.12500000
56:          1964    20 0.15000000
57:          1965     9 0.00000000
58:          1966    12 0.00000000
59:          1967     2 1.00000000
60:          1968     5 0.00000000
61:          1969     1 0.00000000
62:          1971     2 0.00000000
63:          1972     8 0.25000000
64:          1973     5 0.40000000
65:          1974     7 0.00000000
66:          1975     2 0.00000000
67:          1976     6 0.00000000
68:          1977     5 0.00000000
69:          1978     4 0.00000000
70:          1979     4 1.00000000
71:          1980     4 0.00000000
72:          1981     2 0.00000000
73:          1983     3 0.00000000
74:          1984     2 1.00000000
75:          1987     2 0.00000000
76:          1988     5 0.80000000
77:          1989     6 0.00000000
78:          1993     3 0.00000000
79:          1997     1 0.00000000
80:          1999     1 0.00000000
81:          2011  1034 0.43133462
82:          2012  1056 0.44602273
83:          2013   920 0.40000000
84:          2014   922 0.38828633
85:          2015  1083 0.32779317
86:          2016   504 0.24007937
87:          2017   469 0.14925373
88:          2018   572 0.16083916
89:          2019   444 0.14639640
90:          2020   194 0.36597938
91:            NA    49 0.12244898
    MB_year_built     N         V2
> print(dnew[order(MB_effective_year),.(.N,mean(spec)),by=.(MB_effective_year)])
    MB_effective_year     N        V2
                <int> <int>     <num>
 1:              1910     1 0.0000000
 2:              1922     2 1.0000000
 3:              1926     5 0.2000000
 4:              1927     2 1.0000000
 5:              1928     3 1.0000000
 6:              1931     7 0.5714286
 7:              1936     4 1.0000000
 8:              1939    13 0.5384615
 9:              1940    12 0.3333333
10:              1941    11 0.3636364
11:              1942    21 0.7142857
12:              1943     5 0.0000000
13:              1944    18 0.6111111
14:              1945    10 0.2000000
15:              1946    19 0.0000000
16:              1947    19 0.4736842
17:              1948    26 0.1923077
18:              1949    21 0.4285714
19:              1950    25 0.2400000
20:              1951    16 0.5000000
21:              1952     3 0.6666667
22:              1953    26 0.1923077
23:              1954     2 0.0000000
24:              1955    53 0.5471698
25:              1956    11 0.0000000
26:              1957    10 0.2000000
27:              1958     6 0.5000000
28:              1959    12 0.5000000
29:              1960   149 0.2953020
30:              1961     4 0.5000000
31:              1962     7 0.8571429
32:              1963     9 0.1111111
33:              1964    17 0.1176471
34:              1965   182 0.3516484
35:              1966     6 0.5000000
36:              1967     3 0.0000000
37:              1968     7 0.0000000
38:              1969     1 0.0000000
39:              1970   117 0.2307692
40:              1971     7 0.0000000
41:              1972     8 0.2500000
42:              1973     7 0.2857143
43:              1974     6 0.1666667
44:              1975    78 0.2435897
45:              1976     3 0.0000000
46:              1977     8 0.0000000
47:              1978     4 0.0000000
48:              1979     4 1.0000000
49:              1980    49 0.1632653
50:              1982     4 0.5000000
51:              1983     3 0.0000000
52:              1984     6 0.3333333
53:              1985    28 0.1428571
54:              1987     5 0.0000000
55:              1988     4 1.0000000
56:              1989     6 0.0000000
57:              1990    10 0.1000000
58:              1992     1 0.0000000
59:              1993     3 0.0000000
60:              1995     6 0.0000000
61:              1997     1 0.0000000
62:              1999     1 0.0000000
63:              2000     3 0.0000000
64:              2011   728 0.3983516
65:              2012  1093 0.4409881
66:              2013  1048 0.4045802
67:              2014   691 0.4225760
68:              2015  1112 0.3776978
69:              2016   684 0.2602339
70:              2017   413 0.1912833
71:              2018   640 0.1453125
72:              2019   579 0.1485320
73:              2020   213 0.3427230
74:                NA    49 0.1224490
    MB_effective_year     N        V2
> print(dnew[improvementValue>400000])
Key: <ROLL_NUMBER24>
       ROLL_NUMBER24           Roll  rollStart   FOLIO_ID
               <i64>         <char>      <num>     <char>
   1:  1040674670000  1040674670000  104067467 A000000081
   2:  1040674670000  1040674670000  104067467 A000000081
   3:  1040674670000  1040674670000  104067467 A000000081
   4:  1040674670000  1040674670000  104067467 A000000081
   5:  1634024360000  1634024360000  163402436 A0000000FG
  ---                                                    
4134: 25828251390000 25828251390000 2582825139 A000003GRA
4135: 25828251390000 25828251390000 2582825139 A000003GRA
4136: 25828251390000 25828251390000 2582825139 A000003GRA
4137: 25828251390000 25828251390000 2582825139 A000003GRA
4138: 25828251390000 25828251390000 2582825139 A000003GRA
               ACTUAL_USE_DESCRIPTION JURISDICTION_CODE NEIGHBOURHOOD nchar
                               <char>             <int>        <char> <int>
   1: Residential Dwelling with Suite               200    Point Grey    15
   2: Residential Dwelling with Suite               200    Point Grey    15
   3: Residential Dwelling with Suite               200    Point Grey    15
   4: Residential Dwelling with Suite               200    Point Grey    15
   5:          Single Family Dwelling               200    Point Grey    15
  ---                                                                      
4134: Residential Dwelling with Suite               200    Fraserview    15
4135: Residential Dwelling with Suite               200    Fraserview    15
4136: Residential Dwelling with Suite               200    Fraserview    15
4137: Residential Dwelling with Suite               200    Fraserview    15
4138: Residential Dwelling with Suite               200    Fraserview    15
      splitspot rollEnd24 Jurisdiction MB_Year_Built Zoning UNIT_NUMBER
          <int>     <num>        <int>         <int> <char>      <char>
   1:        11         0          200          2011    RS1            
   2:        11         0          200          2011    RS1            
   3:        11         0          200          2011    RS1            
   4:        11         0          200          2011    RS1            
   5:        11         0          200          2011    RS1            
  ---                                                                  
4134:        11         0          200          2013    RS1            
4135:        11         0          200          2013    RS1            
4136:        11         0          200          2013    RS1            
4137:        11         0          200          2013    RS1            
4138:        11         0          200          2013    RS1            
      STREET_NUMBER STREET_DIRECTION_PREFIX STREET_NAME STREET_TYPE
              <int>                  <char>      <char>      <char>
   1:          2767                                ALMA          ST
   2:          2767                                ALMA          ST
   3:          2765                                ALMA          ST
   4:          2765                                ALMA          ST
   5:          4460                                 1ST         AVE
  ---                                                              
4134:          2127                            HARRISON          DR
4135:          2127                            HARRISON          DR
4136:          2129                            HARRISON          DR
4137:          2129                            HARRISON          DR
4138:          2129                            HARRISON          DR
      STREET_DIRECTION_SUFFIX POSTAL_CODE      fullStreet24 streetNoNumber24
                       <char>      <char>            <char>           <char>
   1:                             V6R 3S3     2767  ALMA ST          ALMA ST
   2:                             V6R 3S3     2767  ALMA ST          ALMA ST
   3:                             V6R 3S3     2765  ALMA ST          ALMA ST
   4:                             V6R 3S3     2765  ALMA ST          ALMA ST
   5:                       W     V6R 4J4   4460  1ST AVE W        1ST AVE W
  ---                                                                       
4134:                             V5P 2P7 2127  HARRISON DR      HARRISON DR
4135:                             V5P 2P7 2127  HARRISON DR      HARRISON DR
4136:                             V5P 2P7 2129  HARRISON DR      HARRISON DR
4137:                             V5P 2P7 2129  HARRISON DR      HARRISON DR
4138:                             V5P 2P7 2129  HARRISON DR      HARRISON DR
      streetNumber24    folioID    roll_number MB_year_built MB_effective_year
               <int>     <char>          <i64>         <int>             <int>
   1:           2767 A000000081  1040674670000          2011              2011
   2:           2767 A000000081  1040674670000          2011              2011
   3:           2765 A000000081  1040674670000          2011              2011
   4:           2765 A000000081  1040674670000          2011              2011
   5:           4460 A0000000FG  1634024360000          2011              2011
  ---                                                                         
4134:           2127 A000003GRA 25828251390000          2013              2013
4135:           2127 A000003GRA 25828251390000          2013              2013
4136:           2129 A000003GRA 25828251390000          2013              2013
4137:           2129 A000003GRA 25828251390000          2013              2013
4138:           2129 A000003GRA 25828251390000          2013              2013
      landValue improvementValue streetNumber streetDirectionPrefix streetName
          <int>            <int>        <int>                <lgcl>     <char>
   1:   1356000           707000         2765                    NA       ALMA
   2:   1356000           707000         2767                    NA       ALMA
   3:   1356000           707000         2765                    NA       ALMA
   4:   1356000           707000         2767                    NA       ALMA
   5:   3624000          1149000         4460                    NA        1ST
  ---                                                                         
4134:   1302000          1016000         2127                    NA   HARRISON
4135:   1302000          1016000         2129                    NA   HARRISON
4136:   1302000          1016000         2125                    NA   HARRISON
4137:   1302000          1016000         2127                    NA   HARRISON
4138:   1302000          1016000         2129                    NA   HARRISON
      streetType streetDirectionSuffix postalCode      city thirty  fifty
          <char>                <char>     <char>    <char> <lgcl> <lgcl>
   1:         ST                          V6R 3S3 VANCOUVER   TRUE  FALSE
   2:         ST                          V6R 3S3 VANCOUVER   TRUE  FALSE
   3:         ST                          V6R 3S3 VANCOUVER   TRUE  FALSE
   4:         ST                          V6R 3S3 VANCOUVER   TRUE  FALSE
   5:        AVE                     W    V6R 4J4 VANCOUVER  FALSE   TRUE
  ---                                                                    
4134:         DR                          V5P 2P7 VANCOUVER  FALSE   TRUE
4135:         DR                          V5P 2P7 VANCOUVER  FALSE   TRUE
4136:         DR                          V5P 2P7 VANCOUVER  FALSE   TRUE
4137:         DR                          V5P 2P7 VANCOUVER  FALSE   TRUE
4138:         DR                          V5P 2P7 VANCOUVER  FALSE   TRUE
      laneok rollEnd16    Jur YearBuilt hasLaneway sale2010 sale2011 sale2012
      <lgcl>     <i64> <char>    <char>      <num>    <int>    <int>    <int>
   1:   TRUE         0   <NA>      <NA>          0        1        0        0
   2:   TRUE         0   <NA>      <NA>          0        1        0        0
   3:   TRUE         0   <NA>      <NA>          0        1        0        0
   4:   TRUE         0   <NA>      <NA>          0        1        0        0
   5:  FALSE         0   <NA>      <NA>          0        1        0        0
  ---                                                                        
4134:     NA         0    200      2014          1        0        0        1
4135:     NA         0    200      2014          1        0        0        1
4136:   TRUE         0    200      2014          1        0        0        1
4137:     NA         0    200      2014          1        0        0        1
4138:     NA         0    200      2014          1        0        0        1
      sale2013 sale2014 sale2015 sale2016 sale2017 sale2018 sale2019 sale2020
         <int>    <int>    <int>    <int>    <int>    <int>    <int>    <int>
   1:        0        0        0        0        0        0        0        0
   2:        0        0        0        0        0        0        0        0
   3:        0        0        0        0        0        0        0        0
   4:        0        0        0        0        0        0        0        0
   5:        0        0        0        0        0        0        0        0
  ---                                                                        
4134:        0        0        0        0        0        0        0        0
4135:        0        0        0        0        0        0        0        0
4136:        0        0        0        0        0        0        0        0
4137:        0        0        0        0        0        0        0        0
4138:        0        0        0        0        0        0        0        0
      sale2021 sale2022 sale2023 duplex basement single     type  spec sale2024
         <int>    <int>    <int> <lgcl>   <lgcl> <lgcl>   <char> <num>    <num>
   1:        0        0        0  FALSE     TRUE  FALSE basement     0        0
   2:        0        0        0  FALSE     TRUE  FALSE basement     0        0
   3:        0        0        0  FALSE     TRUE  FALSE basement     0        0
   4:        0        0        0  FALSE     TRUE  FALSE basement     0        0
   5:        0        0        0  FALSE    FALSE   TRUE   single     0        0
  ---                                                                          
4134:        0        0        0  FALSE     TRUE  FALSE  laneway     0        0
4135:        0        0        0  FALSE     TRUE  FALSE  laneway     0        0
4136:        0        0        0  FALSE     TRUE  FALSE  laneway     0        0
4137:        0        0        0  FALSE     TRUE  FALSE  laneway     0        0
4138:        0        0        0  FALSE     TRUE  FALSE  laneway     0        0
> 
> print(summary(feols(typeSpec~shareType |year^nbhd^thirty + type^year ,data=shares,cluster="nbhd")))
NOTE: 1,643 observations removed because of NA values (LHS: 1,643, RHS: 716, Fixed-effects: 112, vcov: 112).
OLS estimation, Dep. Var.: typeSpec
Observations: 933
Fixed-effects: year^nbhd^thirty: 465,  type^year: 49
Standard-errors: Clustered (nbhd) 
          Estimate Std. Error t value  Pr(>|t|)    
shareType 0.147103   0.044878 3.27781 0.0035911 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.199853     Adj. R2: 0.235263
                 Within R2: 0.013226
> shares[,nbhdType:=paste0(nbhd,"_",type)]
> print(summary(feols(typeSpec~shareType |year^type + nbhd^year^thirty + nbhdType^thirty,data=shares,cluster="nbhdType")))
NOTE: 1,643 observations removed because of NA values (LHS: 1,643, RHS: 716, Fixed-effects: 112).
OLS estimation, Dep. Var.: typeSpec
Observations: 933
Fixed-effects: year^type: 49,  nbhd^year^thirty: 465,  nbhdType^thirty: 145
Standard-errors: Clustered (nbhdType) 
          Estimate Std. Error t value Pr(>|t|) 
shareType  0.07303   0.067877 1.07592  0.28512 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.166591     Adj. R2: 0.190392
                 Within R2: 0.003062
> print(summary(feols(typeSpec~shareType |year^type + nbhd^year^thirty + nbhdType^thirty,data=shares[year<2020 & type!="duplex"],cluster="nbhdType")))
NOTE: 718 observations removed because of NA values (LHS: 718, RHS: 363, Fixed-effects: 60).
OLS estimation, Dep. Var.: typeSpec
Observations: 662
Fixed-effects: year^type: 30,  nbhd^year^thirty: 338,  nbhdType^thirty: 106
Standard-errors: Clustered (nbhdType) 
          Estimate Std. Error t value Pr(>|t|) 
shareType  0.14064   0.087753 1.60268  0.11426 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.170122     Adj. R2: 0.118125
                 Within R2: 0.010192
> print(summary(feols(specShare~ priceLag |year^type + nbhd^year^thirty + nbhd^type^thirty,data=shares[type!="duplex"],cluster="nbhd")))
NOTE: 1,146 observations removed because of NA values (LHS: 1,068, RHS: 545, Fixed-effects: 84, vcov: 84).
OLS estimation, Dep. Var.: specShare
Observations: 786
Fixed-effects: year^type: 42,  nbhd^year^thirty: 286,  nbhd^type^thirty: 113
Standard-errors: Clustered (nbhd) 
          Estimate Std. Error  t value Pr(>|t|)    
priceLag -0.408803   0.133424 -3.06394 0.005892 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.247223     Adj. R2: 0.071521
                 Within R2: 0.031391
> print(summary(feols(specShare~ priceLag |year^type + nbhd^year^thirty ,data=shares[type!="duplex"],cluster="nbhd")))
NOTE: 1,146 observations removed because of NA values (LHS: 1,068, RHS: 545, Fixed-effects: 84, vcov: 84).
OLS estimation, Dep. Var.: specShare
Observations: 786
Fixed-effects: year^type: 42,  nbhd^year^thirty: 286
Standard-errors: Clustered (nbhd) 
          Estimate Std. Error  t value Pr(>|t|) 
priceLag -0.148443   0.146627 -1.01238  0.32288 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.320591     Adj. R2: -0.179525
                 Within R2:  0.003251
> print(summary(feols(specShare~ priceLag |year^type+ nbhd^year^thirty + nbhd^type^thirty,data=shares[year<2020 & type!="duplex"],cluster="nbhd")))
NOTE: 759 observations removed because of NA values (LHS: 705, RHS: 365, Fixed-effects: 60, vcov: 60).
OLS estimation, Dep. Var.: specShare
Observations: 621
Fixed-effects: year^type: 30,  nbhd^year^thirty: 224,  nbhd^type^thirty: 111
Standard-errors: Clustered (nbhd) 
          Estimate Std. Error  t value Pr(>|t|)    
priceLag -0.379019   0.149434 -2.53637 0.019643 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.254511     Adj. R2: 0.027718
                 Within R2: 0.024149
> # Funny sales result
> print(shares[,mean(priceLag,na.rm=TRUE),by=.(type,year)])
        type  year       V1
      <char> <num>    <num>
 1:   single  2010 13.90410
 2:   duplex  2010 13.12528
 3:  laneway  2010 13.64382
 4: basement  2010 13.81422
 5:   single  2011 13.96621
 6:   duplex  2011 13.52345
 7:  laneway  2011 13.78047
 8: basement  2011 13.91504
 9:   single  2012 14.16372
10:   duplex  2012 13.50061
11:  laneway  2012 13.96643
12: basement  2012 14.07325
13:   single  2013 14.19745
14:   duplex  2013 13.46595
15:  laneway  2013 13.93102
16: basement  2013 14.14325
17:   single  2014 14.22347
18:   duplex  2014 13.51176
19:  laneway  2014 14.06765
20: basement  2014 14.10597
21:   single  2015 14.27639
22:   duplex  2015 13.56062
23:  laneway  2015 14.14283
24: basement  2015 14.22343
25:   single  2016 14.51123
26:   duplex  2016 14.10547
27:  laneway  2016 14.38768
28: basement  2016 14.42492
29:   single  2017 14.67559
30:   duplex  2017 14.40794
31:  laneway  2017 14.65227
32: basement  2017 14.66024
33:   single  2018 14.72403
34:   duplex  2018 14.19120
35:  laneway  2018 14.67944
36: basement  2018 14.68135
37:   single  2019 14.64576
38:   duplex  2019 14.39701
39:  laneway  2019 14.66494
40: basement  2019 14.64879
41:   single  2020 14.56685
42:   duplex  2020 13.86905
43:  laneway  2020 14.67243
44: basement  2020 14.51643
45:   single  2021 14.68580
46:   duplex  2021 14.21309
47:  laneway  2021 14.72981
48: basement  2021 14.63282
49:   single  2022 14.70824
50:   duplex  2022 14.39208
51:  laneway  2022 14.82641
52: basement  2022 14.74360
53:   single  2023 14.73514
54:   duplex  2023 14.44768
55:  laneway  2023 15.03271
56: basement  2023 14.75564
        type  year       V1
> print(shares[,mean(priceLag,na.rm=TRUE),by=.(type,nbhd)])
        type                              nbhd       V1
      <char>                            <char>    <num>
 1:   single                              <NA>      NaN
 2:   duplex                              <NA>      NaN
 3:  laneway                              <NA>      NaN
 4: basement                              <NA>      NaN
 5:   single                        Point Grey 14.82674
 6:   duplex                        Point Grey 14.74754
 7:  laneway                        Point Grey 14.72999
 8: basement                        Point Grey 14.81604
 9:   single                         Kitsilano 14.70663
10:   duplex                         Kitsilano 14.71381
11:  laneway                         Kitsilano 14.59512
12: basement                         Kitsilano 14.63108
13:   single                            Dunbar 14.75880
14:   duplex                            Dunbar      NaN
15:  laneway                            Dunbar 14.71232
16: basement                            Dunbar 14.77642
17:   single Arbutus Ridge - Mackenzie Heights 14.79949
18:   duplex Arbutus Ridge - Mackenzie Heights 14.76227
19:  laneway Arbutus Ridge - Mackenzie Heights 14.68332
20: basement Arbutus Ridge - Mackenzie Heights 14.73651
21:   single                        Kerrisdale 14.75852
22:   duplex                        Kerrisdale 14.68380
23:  laneway                        Kerrisdale 14.77983
24: basement                        Kerrisdale 14.67396
25:   single                        Southlands 14.57897
26:   duplex                        Southlands 14.79007
27:  laneway                        Southlands 14.46841
28: basement                        Southlands 14.46030
29:   single                       Shaughnessy 14.93132
30:   duplex                       Shaughnessy      NaN
31:  laneway                       Shaughnessy 14.79283
32: basement                       Shaughnessy 14.91275
33:   single                            Cambie 14.60925
34:   duplex                            Cambie 14.59850
35:  laneway                            Cambie 14.45535
36: basement                            Cambie 14.56924
37:   single                   South Granville 14.78176
38:   duplex                   South Granville      NaN
39:  laneway                   South Granville 14.66614
40: basement                   South Granville 14.72124
41:   single                          Oakridge 14.55525
42:   duplex                          Oakridge      NaN
43:  laneway                          Oakridge 14.50543
44: basement                          Oakridge 14.49198
45:   single                           Marpole 14.45517
46:   duplex                           Marpole 14.46762
47:  laneway                           Marpole 14.47113
48: basement                           Marpole 14.47145
49:   single                         Grandview 14.01436
50:   duplex                         Grandview 14.23591
51:  laneway                         Grandview 14.12284
52: basement                         Grandview 13.98294
53:   single                     Cedar Cottage 14.21027
54:   duplex                     Cedar Cottage 14.32472
55:  laneway                     Cedar Cottage 14.18685
56: basement                     Cedar Cottage 14.21476
57:   single                     Main & Fraser 13.98372
58:   duplex                     Main & Fraser 14.40397
59:  laneway                     Main & Fraser 14.16457
60: basement                     Main & Fraser 14.13191
61:   single                   South Vancouver 13.95087
62:   duplex                   South Vancouver 14.05704
63:  laneway                   South Vancouver 14.12665
64: basement                   South Vancouver 14.08560
65:   single                            Knight 13.99523
66:   duplex                            Knight 13.93490
67:  laneway                            Knight 13.94878
68: basement                            Knight 14.04303
69:   single                     Hastings East 13.90494
70:   duplex                     Hastings East 14.04563
71:  laneway                     Hastings East 13.89853
72: basement                     Hastings East 14.01560
73:   single                           Renfrew 13.92103
74:   duplex                           Renfrew 14.10750
75:  laneway                           Renfrew 13.97197
76: basement                           Renfrew 14.07051
77:   single                   Renfrew Heights 13.96770
78:   duplex                   Renfrew Heights 14.05342
79:  laneway                   Renfrew Heights 14.02169
80: basement                   Renfrew Heights 14.07548
81:   single                       Collingwood 13.95843
82:   duplex                       Collingwood 13.91509
83:  laneway                       Collingwood 14.14062
84: basement                       Collingwood 13.95582
85:   single                         Killarney 14.05254
86:   duplex                         Killarney 14.03818
87:  laneway                         Killarney 14.14500
88: basement                         Killarney 14.16333
89:   single                        Fraserview 14.05455
90:   duplex                        Fraserview 14.17473
91:  laneway                        Fraserview 14.17078
92: basement                        Fraserview 14.17422
        type                              nbhd       V1
> # convergance?
> print(shares[year==2017,mean(priceLag,na.rm=TRUE),by=.(type,thirty,nbhd)])
         type thirty       nbhd       V1
       <char>  <num>     <char>    <num>
  1:   single      0       <NA>      NaN
  2:   duplex      0       <NA>      NaN
  3:  laneway      0       <NA>      NaN
  4: basement      0       <NA>      NaN
  5:   single      1       <NA>      NaN
 ---                                    
180: basement      0 Fraserview 14.66993
181:   single      1 Fraserview      NaN
182:   duplex      1 Fraserview      NaN
183:  laneway      1 Fraserview      NaN
184: basement      1 Fraserview 14.03062
> # is it desirable to have neighbourhood-type dummies?
> 
> shares[,rr:=runif(nrow(shares))]
> x <- feols(shareType ~ rr|type+year+nbhd,data=shares)
NOTE: 716 observations removed because of NA values (LHS: 716, Fixed-effects: 112).
> print(c(var(x$residuals),var(shares$shareType,na.rm=TRUE)))
[1] 0.08534059 0.11237014
> x <- feols(shareType ~ rr|type^year + nbhd^year,data=shares)
NOTE: 716 observations removed because of NA values (LHS: 716, Fixed-effects: 112).
> print(c(var(x$residuals),var(shares$shareType,na.rm=TRUE)))
[1] 0.0714963 0.1123701
> x <- feols(shareType ~ rr|type^year+type^nbhd+nbhd^year,data=shares)
NOTE: 716 observations removed because of NA values (LHS: 716, Fixed-effects: 112).
> print(c(var(x$residuals),var(shares$shareType,na.rm=TRUE)))
[1] 0.05475012 0.11237014
> x <- feols(shareType ~ rr|nbhd^type,data=shares)
NOTE: 716 observations removed because of NA values (LHS: 716, Fixed-effects: 112).
> print(c(var(x$residuals),var(shares$shareType,na.rm=TRUE)))
[1] 0.06809965 0.11237014
> 
> 
> ggplot(shares[type=="laneway",.(type,shareType,typeSpec,year),],aes(x=shareType,y=typeSpec,color=year)) +
+     geom_point() 
Warning message:
Removed 286 rows containing missing values or values outside the scale range
(`geom_point()`). 
> ggsave("text/shareCustom.png")
Saving 7 x 7 in image
Warning message:
Removed 286 rows containing missing values or values outside the scale range
(`geom_point()`). 
> 
> ggplot(shares[,.(shareType,typeSpec,nbhd)],aes(x=shareType,y=typeSpec,color=nbhd)) + geom_point() 
Warning message:
Removed 1643 rows containing missing values or values outside the scale range
(`geom_point()`). 
> ggsave("text/shareSpecType.png")
Saving 7 x 7 in image
Warning message:
Removed 1643 rows containing missing values or values outside the scale range
(`geom_point()`). 
> 
> 
> 
> proc.time()
   user  system elapsed 
 10.377   0.541  13.643 
